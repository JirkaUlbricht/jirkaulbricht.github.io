<!DOCTYPE html>
<?php
   include("config.php");
   session_start();

   if($_SERVER["REQUEST_METHOD"] == "POST") {
      // username and password sent from form

      $myusername = mysqli_real_escape_string($db,$_POST['username']);
      $mypassword = mysqli_real_escape_string($db,$_POST['password']);

      $sql = "SELECT id FROM admin WHERE username = '$myusername' and passcode = '$mypassword'";
      $result = mysqli_query($db,$sql);
      $row = mysqli_fetch_array($result,MYSQLI_ASSOC);
      $active = $row['active'];

      $count = mysqli_num_rows($result);

      // If result matched $myusername and $mypassword, table row must be 1 row

      if($count == 1) {
         session_register("myusername");
         $_SESSION['login_user'] = $myusername;

         header("location: welcome.php");
      }else {
         $error = "Your Login Name or Password is invalid";
      }
   }
?>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Log in</title>
    <link rel="icon" type="image/x-icon" href="../img/favicon.ico">
    <meta name="title" content="Log in">
    <meta name="description" content="Official website of The Cloud Project<br> Small scale storage done simple, easy and free!">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <link href="../stylesheets/main.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
          integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&family=Sono:wght@500&display=swap" rel="stylesheet">
</head>
<body>
<header id="navbar">
    <a href="#welcome"><p class="logo-header"><i class="fa-solid fa-cloud"></i> The Cloud Project</p></a>
    <a href="login" class="login-btn">Log in</a>
</header>

<section>
    <h1>Log in</h1>
    <div>
        <div style = "width:300px; border: solid 1px #333333; " >
            <div style = "background-color:#333333; color:#FFFFFF; padding:3px;"><b>Login</b></div>
            <div style = "margin:30px">
                <form action = "" method = "post">
                    <label>Username: </label><input type = "text" name = "username" class = "box"/><br /><br />
                    <label>Password: </label><input type = "password" name = "password" class = "box" /><br/><br />
                    <input type = "submit" value = " Submit "/><br />
                </form>
                <div style = "font-size:11px; color:#cc0000; margin-top:10px"><?php echo $error; ?></div>
            </div>
        </div>
    </div>
</section>
<a href="../profile">Log in</a>
<a href="../">Back</a>

<footer id="main-footer" class="text-center">
    <div class="container center">
        Copyright &copy; 2023 The Cloud Project, all rights reserved
    </div>
</footer>
</body>
</html>