<!DOCTYPE html>
<?php
   include("config.php");
   session_start();

   if($_SERVER["REQUEST_METHOD"] == "POST") {
      // username and password sent from form

      $myusername = mysqli_real_escape_string($db,$_POST['username']);
      $mypassword = mysqli_real_escape_string($db,$_POST['password']);

      $sql = "SELECT id FROM admin WHERE username = '$myusername' and passcode = '$mypassword'";
      $result = mysqli_query($db,$sql);
      $row = mysqli_fetch_array($result,MYSQLI_ASSOC);
      $active = $row['active'];

      $count = mysqli_num_rows($result);

      // If result matched $myusername and $mypassword, table row must be 1 row

      if($count == 1) {
         session_register("myusername");
         $_SESSION['login_user'] = $myusername;

         header("location: welcome.php");
      }else {
         $error = "Your Login Name or Password is invalid";
      }
   }
?>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Log in</title>
    <link rel="icon" type="image/x-icon" href="../img/favicon.ico">
    <meta name="title" content="Log in">
    <meta name="description" content="Official website of The Cloud Project<br> Small scale storage done simple, easy and free!">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <link href="../stylesheets/main.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
          integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&family=Sono:wght@500&display=swap" rel="stylesheet">
</head>
<body>
<header id="navbar">
    <a href="/Cloud"><p class="logo-header"><i class="fa-solid fa-cloud"></i> The Cloud Project</p></a>
    <a href="/Cloud" class="login-btn">Back</a>
</header>

<section id="login">
    <h1 class="container-sml">Log in</h1>
    <div class="login-form">
        <form action="" method="POST">
            <label for="username">Username: </label>
            <input id="username" type="text" name="username" class="box" placeholder="Username"/><br /><br />
            <label for="password">Password: </label>
            <input id="password" type="password" name="password" class="box" placeholder="Password"/><br/><br />
            <input type="submit" value="Submit" class="log-in center"/><br />
        </form>
        <div><?php echo $error; ?></div>
    </div>
</section>
<a href="../profile">To profile page</a>

<footer id="main-footer-login" class="text-center">
    <div class="container center">
        Copyright &copy; 2023 The Cloud Project, all rights reserved
    </div>
</footer>
</body>
</html>